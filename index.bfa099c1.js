const e=async e=>{try{const t=await fetch(`https://metaweather-api.glitch.me/${e}`);if(!t.ok)throw new Error("Something went wrong");return await t.json()}catch(e){console.log(e)}};class t{async getQueryLocations(t){const a=`/api/location/search/?query=${t}`;return await e(a)}async getWeatherData(t){const a=`/api/location/${t}`;return await e(a)}async getHistoricalWeatherData(t,a){const s=`/api/location/${t}/${a}`;return await e(s)}}class a{static set(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.log(e)}}static get(e){try{return JSON.parse(localStorage.getItem(e))}catch(e){console.log(e)}return null}static remove(e){try{localStorage.removeItem(e)}catch(e){console.log(e)}}}class s{setText(e){this.elem.innerText=e}setImage(e){this.elem.src=e}setWindIcon(e){e+=90,this.elem.style.transform=`rotate(${e}deg)`}setDatalistChildren(e){this.elem.innerHTML="",e.forEach((e=>{const t=document.createElement("option");t.value=e.title,t.dataset.woeid=e.woeid,this.elem.append(t)}))}toggleDisplay(){this.elem.style.display="none"===this.elem.style.display?"flex":"none"}reset(){this.elem.value=""}setDay(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][((new Date).getDay()+e)%7]}setMonth(){return["January","February","March","April","May","June","July","August","September","October","November","December"][(new Date).getMonth()%12]}static setUpdatedTime(e,t){const a=Date.now()-Date.parse(t);let s=Math.floor(a/1e3%60),r=Math.floor(a/6e4%60),n=Math.floor(a/36e5%24);n=n<10?"0"+n:n,r=r<10?"0"+r:r,s=s<10?"0"+s:s,e.setText(`Updated ${n} hours ${r} minutes ago`)}static setWarsawWeather(e){new s("local-city").setText(e.title);const t=new s("local-date");t.setText(`${t.setDay(0)} ${(new Date).getDate()} ${t.setMonth()}`);new s("local-abbr").setImage(`https://www.metaweather.com/static/img/weather/${e.consolidated_weather[0].weather_state_abbr}.svg`);new s("local-temp").setText(`${parseInt(e.consolidated_weather[0].the_temp,10)}°C`);new s("local-state").setText(`${e.consolidated_weather[0].weather_state_name}`);new s("local-low").setText(`${parseInt(e.consolidated_weather[0].min_temp,10)}°C`);new s("local-high").setText(`${parseInt(e.consolidated_weather[0].max_temp,10)}°C`);new s("local-speed").setText(`${parseInt(e.consolidated_weather[0].wind_speed,10)} mph`)}static setLastWeather(e){new s("home-city").setText(e.title);const t=new s("home-date");t.setText(`${t.setDay(0)} ${(new Date).getDate()} ${t.setMonth()}`);new s("home-temp").setText(`${parseInt(e.consolidated_weather[0].the_temp,10)}°C`);new s("home-min").setText(`${parseInt(e.consolidated_weather[0].min_temp,10)}°C`);new s("home-max").setText(`${parseInt(e.consolidated_weather[0].max_temp,10)}°C`);new s("home-speed").setText(`${parseInt(e.consolidated_weather[0].wind_speed,10)} mph`);const a=new s("home-update-time"),r=e.consolidated_weather[0].created;s.setUpdatedTime(a,r)}setDisplay(e){this.elem.style.display=e}constructor(e){this.elem=document.getElementById(e)}}var r,n,o;o=e=>{new s("daily-city-name").setText(e.title),new s("daily-current-time").setText(e.time.substr(11,5)),new s("daily-abbr").setImage(`https://www.metaweather.com/static/img/weather/${e.consolidated_weather[0].weather_state_abbr}.svg`),new s("daily-temp").setText(`${parseInt(e.consolidated_weather[0].the_temp,10)}°C`),new s("daily-state").setText(e.consolidated_weather[0].weather_state_name),new s("daily-min").setText(`min: ${parseInt(e.consolidated_weather[0].min_temp,10)}°C`),new s("daily-max").setText(`max: ${parseInt(e.consolidated_weather[0].max_temp,10)}°C`),new s("daily-arrow").setWindIcon(e.consolidated_weather[0].wind_direction),new s("daily-wind-speed").setText(`${parseInt(e.consolidated_weather[0].wind_speed,10)} mph`);const t=new s("daily-update");s.setUpdatedTime(t,e.consolidated_weather[0].created);for(let t=1;t<6;t++){const a=new s(`card${t}-abbr`),r=new s(`card${t}-temp`),n=new s(`card${t}-state`),o=new s(`card${t}-wind`),i=new s(`card${t}-arrow`),c=new s(`card${t}-day`);a.setImage(`https://www.metaweather.com/static/img/weather/${e.consolidated_weather[t].weather_state_abbr}.svg`),r.setText(`${parseInt(e.consolidated_weather[t].the_temp,10)}°C`),n.setText(e.consolidated_weather[t].weather_state_name),o.setText(`${parseInt(e.consolidated_weather[t].wind_speed,10)} mph`),i.setWindIcon(e.consolidated_weather[t].wind_direction),c.setText(c.setDay(t))}},(n="setWeatherInfo")in(r=s)?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o;class i{static set(e,t){try{window.sessionStorage.setItem(e,JSON.stringify(t))}catch(e){console.error(e)}}static get(e){try{return JSON.parse(window.sessionStorage.getItem(e))}catch(e){return console.error(e),!1}}}const c=new t,l=new s("home-view"),d=new s("search-view"),w=new s("last-weather-info"),h=new s("page-loadingSpinner"),m=(e,t)=>{if("search"!==e)history.replaceState(null,null,"/");else{const a=new URLSearchParams({action:e,...t});history.pushState(null,null,`?${a.toString()}`)}u()},u=async()=>{const e=new URLSearchParams(window.location.search),t=e.get("id");if("search"!==e.get("action"))a.get("lastWeather")?(s.setLastWeather(a.get("lastWeather")),w.setDisplay("flex")):w.setDisplay("none"),l.setDisplay("flex"),d.setDisplay("none");else{let e,r;h.setDisplay("flex"),i.get(t)?e=i.get(t):(e=await c.getWeatherData(t),i.set(t,e)),a.set("lastWeather",e),i.get(523920)?r=i.get(523920):(r=await c.getWeatherData(523920),i.set(523920,r)),s.setWeatherInfo(e),s.setWarsawWeather(r),h.setDisplay("none"),l.setDisplay("none"),d.setDisplay("flex")}},y="standby",p="error",g="ready",_="loading",f="reload",x=(e,t)=>{switch([...e.querySelector(".search-icon-container").children].forEach((e=>{e.classList.remove("active")})),t){case"standby":e.querySelector(".fa-search").classList.add("active");break;case"loading":e.querySelector(".lds-spinner").classList.add("active");break;case"error":e.querySelector(".fa-exclamation").classList.add("active");break;case"ready":e.querySelector(".fa-check").classList.add("active");break;case"reload":e.querySelector(".fa-redo").classList.add("active");break;default:console.log("unexpected input")}},T=(e,t)=>{let a;return function(...s){clearTimeout(a),a=setTimeout((()=>{clearTimeout(a),e(...s)}),t)}};let $=y;const b=new t,v=async e=>{const t=e.target,a=e.target.closest("form"),r=a.querySelector(".search-info-container p");if(r.innerText="",!e.target.value)return $=y,void x(a,$);$=_,x(a,$);try{const n=await b.getQueryLocations(e.target.value);if(n.length<1)return console.log("No locations found"),$=p,x(a,$),void(r.innerText="No results");new s("results").setDatalistChildren(n),((e,t)=>{const a=e.find((({title:e})=>e.toLowerCase()===t.value.toLowerCase()));return!!a&&(t.dataset.currentWoeid=a.woeid,t.dataset.currentCity=a.title,!0)})(n,t)?($=g,x(a,$)):($=y,x(a,$))}catch(e){$=f,x(a,$),r.innerText="Try again"}},S=e=>{const t=e.target.closest("form"),a=t.querySelector("input"),s=t.querySelector(".search-info-container p");a.value="",$=y,x(t,$),s.innerText=""},D=e=>{e.target.closest("form").querySelector(".search-info-container p").innerText="";const t=new s("home-input"),a=new s("daily-input"),r=document.querySelector(".home-search-bar"),n=document.querySelector(".daily-search-bar");t.reset(),a.reset(),$=y,x(r,$),x(n,$),m("",{})},I=(new t,document.querySelector(".home-search-bar")),L=document.querySelector(".daily-search-bar"),W=new s("home-input"),C=new s("daily-input"),q=document.querySelectorAll(".fa-times"),E=document.querySelectorAll(".fa-redo");function M(e){if(e.preventDefault(),$!==g)return;let t=this.getElementsByTagName("input")[0];(t.dataset.currentWoeid||t.dataset.currentCity)&&m("search",{id:t.dataset.currentWoeid,title:t.dataset.currentCity})}new s("search-view").toggleDisplay(),x(I,$),W.elem.addEventListener("input",T(v,1e3)),I.addEventListener("submit",M),C.elem.addEventListener("input",T(v,1e3)),L.addEventListener("submit",M),q.forEach((e=>{e.addEventListener("click",S)})),E.forEach((e=>{e.addEventListener("click",D)})),window.addEventListener("popstate",u),document.addEventListener("DOMContentLoaded",(()=>u()));
//# sourceMappingURL=index.bfa099c1.js.map
