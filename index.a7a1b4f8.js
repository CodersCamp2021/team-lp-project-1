const e=async e=>{try{const t=await fetch(`https://metaweather-api.glitch.me/${e}`);if(!t.ok)throw new Error("Something went wrong");return await t.json()}catch(e){console.log(e)}};class t{async getQueryLocations(t){const a=`/api/location/search/?query=${t}`;return await e(a)}async getWeatherData(t){const a=`/api/location/${t}`;return await e(a)}async getHistoricalWeatherData(t,a){const s=`/api/location/${t}/${a}`;return await e(s)}}class a{static set(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(e){console.log(e)}}static get(e){try{return JSON.parse(localStorage.getItem(e))}catch(e){console.log(e)}return null}static remove(e){try{localStorage.removeItem(e)}catch(e){console.log(e)}}}class s{setText(e){this.elem.innerText=e}setImage(e){this.elem.src=e}setWindIcon(e){e+=90,this.elem.style.transform=`rotate(${e}deg)`}setDatalistChildren(e){this.elem.innerHTML="",e.forEach((e=>{const t=document.createElement("option");t.value=e.title,t.dataset.woeid=e.woeid,this.elem.append(t)}))}toggleDisplay(){this.elem.style.display="none"===this.elem.style.display?"flex":"none"}reset(){this.elem.value=""}setDay(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][((new Date).getDay()+e)%7]}setMonth(){return["January","February","March","April","May","June","July","August","September","October","November","December"][(new Date).getMonth()%12]}static setUpdatedTime(e,t){const a=Date.now()-Date.parse(t);let s=Math.floor(a/1e3%60),n=Math.floor(a/6e4%60),r=Math.floor(a/36e5%24);r=r<10?"0"+r:r,n=n<10?"0"+n:n,s=s<10?"0"+s:s,e.setText(`Updated ${r} hours ${n} minutes ago`)}static setWarsawWeather(e){new s("local-city").setText(e.title);const t=new s("local-date");t.setText(`${t.setDay(0)} ${(new Date).getDate()} ${t.setMonth()}`);new s("local-abbr").setImage(`https://www.metaweather.com/static/img/weather/${e.consolidated_weather[0].weather_state_abbr}.svg`);new s("local-temp").setText(`${parseInt(e.consolidated_weather[0].the_temp,10)}°C`);new s("local-low").setText(`${parseInt(e.consolidated_weather[0].min_temp,10)}°C`);new s("local-high").setText(`${parseInt(e.consolidated_weather[0].max_temp,10)}°C`);new s("local-speed").setText(`${parseInt(e.consolidated_weather[0].wind_speed,10)} mph`)}static setLastWeather(e){new s("home-city").setText(e.title);const t=new s("home-date");t.setText(`${t.setDay(0)} ${(new Date).getDate()} ${t.setMonth()}`);new s("home-temp").setText(`${parseInt(e.consolidated_weather[0].the_temp,10)}°C`);new s("home-min").setText(`${parseInt(e.consolidated_weather[0].min_temp,10)}°C`);new s("home-max").setText(`${parseInt(e.consolidated_weather[0].max_temp,10)}°C`);new s("home-speed").setText(`${parseInt(e.consolidated_weather[0].wind_speed,10)} mph`);const a=new s("home-update-time"),n=e.consolidated_weather[0].created;s.setUpdatedTime(a,n)}setDisplay(e){this.elem.style.display=e}constructor(e){this.elem=document.getElementById(e)}}var n,r,o;o=e=>{new s("daily-city-name").setText(e.title),new s("daily-current-time").setText(e.time.substr(11,5)),new s("daily-abbr").setImage(`https://www.metaweather.com/static/img/weather/${e.consolidated_weather[0].weather_state_abbr}.svg`),new s("daily-temp").setText(`${parseInt(e.consolidated_weather[0].the_temp,10)}°C`),new s("daily-state").setText(e.consolidated_weather[0].weather_state_name),new s("daily-min").setText(`min: ${parseInt(e.consolidated_weather[0].min_temp,10)}°C`),new s("daily-max").setText(`max: ${parseInt(e.consolidated_weather[0].max_temp,10)}°C`),new s("daily-arrow").setWindIcon(e.consolidated_weather[0].wind_direction),new s("daily-wind-speed").setText(`${parseInt(e.consolidated_weather[0].wind_speed,10)}\n mph`);const t=new s("daily-update");s.setUpdatedTime(t,e.consolidated_weather[0].created);for(let t=1;t<6;t++){const a=new s(`card${t}-abbr`),n=new s(`card${t}-temp`),r=new s(`card${t}-state`),o=new s(`card${t}-wind`),i=new s(`card${t}-arrow`),c=new s(`card${t}-day`);a.setImage(`https://www.metaweather.com/static/img/weather/${e.consolidated_weather[t].weather_state_abbr}.svg`),n.setText(`${parseInt(e.consolidated_weather[t].the_temp,10)}°C`),r.setText(e.consolidated_weather[t].weather_state_name),o.setText(`${parseInt(e.consolidated_weather[t].wind_speed,10)}\n mph`),i.setWindIcon(e.consolidated_weather[t].wind_direction),c.setText(c.setDay(t))}},(r="setWeatherInfo")in(n=s)?Object.defineProperty(n,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[r]=o;const i="standby",c="error",l="ready",d="loading",w="reload",h=(e,t)=>{switch([...e.querySelector(".search-icon-container").children].forEach((e=>{e.classList.remove("active")})),t){case"standby":e.querySelector(".fa-search").classList.add("active");break;case"loading":e.querySelector(".lds-spinner").classList.add("active");break;case"error":e.querySelector(".fa-exclamation").classList.add("active");break;case"ready":e.querySelector(".fa-check").classList.add("active");break;case"reload":e.querySelector(".fa-redo").classList.add("active");break;default:console.log("unexpected input")}},m=(e,t)=>{let a;return function(...s){clearTimeout(a),a=setTimeout((()=>{clearTimeout(a),e(...s)}),t)}};let u=i;const y=new t,p=async e=>{const t=e.target,a=e.target.closest("form"),n=a.querySelector(".search-info-container p");if(n.innerText="",!e.target.value)return u=i,void h(a,u);u=d,h(a,u);try{const r=await y.getQueryLocations(e.target.value);if(r.length<1)return console.log("No locations found"),u=c,h(a,u),void(n.innerText="No results");new s("results").setDatalistChildren(r),((e,t)=>{const a=e.find((({title:e})=>e.toLowerCase()===t.value.toLowerCase()));return!!a&&(t.dataset.currentWoeid=a.woeid,t.dataset.currentCity=a.title,!0)})(r,t)?(u=l,h(a,u)):(u=i,h(a,u))}catch(e){u=w,h(a,u),n.innerText="Try again"}},g=e=>{const t=e.target.closest("form"),a=t.querySelector("input"),s=t.querySelector(".search-info-container p");a.value="",u=i,h(t,u),s.innerText=""};class _{static set(e,t){try{window.sessionStorage.setItem(e,JSON.stringify(t))}catch(e){console.error(e)}}static get(e){try{return JSON.parse(window.sessionStorage.getItem(e))}catch(e){return console.error(e),!1}}}const f=new t,x=new s("home-view"),T=new s("search-view"),$=new s("last-weather-info"),b=new s("page-loadingSpinner"),v=(e,t)=>{if("search"!==e)history.replaceState(null,null,"/");else{const a=new URLSearchParams({action:e,...t});history.pushState(null,null,`?${a.toString()}`)}S()},S=async()=>{const e=new URLSearchParams(window.location.search),t=e.get("id");if("search"!==e.get("action"))a.get("lastWeather")?(s.setLastWeather(a.get("lastWeather")),$.setDisplay("flex")):$.setDisplay("none"),x.setDisplay("flex"),T.setDisplay("none");else{let e,n;b.setDisplay("flex"),_.get(t)?e=_.get(t):(e=await f.getWeatherData(t),_.set(t,e)),a.set("lastWeather",e),_.get(523920)?n=_.get(523920):(n=await f.getWeatherData(523920),_.set(523920,n)),s.setWeatherInfo(e),s.setWarsawWeather(n),b.setDisplay("none"),x.setDisplay("none"),T.setDisplay("flex")}},D=(new t,document.querySelector(".home-search-bar")),I=document.querySelector(".daily-search-bar"),L=new s("home-input"),W=new s("daily-input"),C=document.querySelectorAll(".fa-times"),q=document.querySelectorAll(".fa-redo");function E(e){if(e.preventDefault(),u!==l)return;let t=this.getElementsByTagName("input")[0];v("search",{id:t.dataset.currentWoeid,title:t.dataset.currentCity})}new s("search-view").toggleDisplay(),h(D,u),L.elem.addEventListener("input",m(p,1500)),D.addEventListener("submit",E),W.elem.addEventListener("input",m(p,1500)),I.addEventListener("submit",E),C.forEach((e=>{e.addEventListener("click",g)})),q.forEach((e=>{e.addEventListener("click",(()=>{(()=>{const e=new s("home-input"),t=new s("daily-input"),a=document.querySelector(".home-search-bar"),n=document.querySelector(".daily-search-bar");e.reset(),t.reset(),u=i,h(a,u),h(n,u)})(),v("",{})}))})),window.addEventListener("popstate",S),document.addEventListener("DOMContentLoaded",(()=>S()));
//# sourceMappingURL=index.a7a1b4f8.js.map
